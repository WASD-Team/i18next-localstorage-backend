!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):n.i18nextLocalStorageBackend=e()}(this,function(){"use strict";function n(n){for(var e=o({},n),t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return i.each(function(n){if(n)for(var t in n)void 0===e[t]&&(e[t]=n[t])}),e}function e(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function t(){return void 0!==global.window&&!!global.window.localStorage}function i(n,e){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=t.prefix;return""+(void 0===i?"":i)+n+"-"+e}function r(){return{prefix:"i18next_res_",expirationTime:6048e5,versions:{}}}var o=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},a=function(){function n(n,e){for(var t=0;t<e.length;t++){var i=e[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}(),u={setItem:function(n,e){if(t())try{global.window.localStorage.setItem(n,e)}catch(n){}},getItem:function(n,e){if(t())try{return global.window.localStorage.getItem(n,e)}catch(n){return}}},l=function(){function o(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e(this,o),this.init(n,t),this.type="backend"}return a(o,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=n(t,this.options||{},r())}},{key:"get",value:function(n,e){if(!t())return!1;var r=u.getItem(i(n,e,this.options));return!!r&&JSON.parse(r)}},{key:"read",value:function(n,e,t){var i=this.get(n,e);if(!i)return t(null,null);var r=(new Date).getTime();if(i.i18nStamp)return t(null,null);if(i.i18nStamp+this.options.expirationTime<r)return t(null,null);var o=this.options.versions[n];return o instanceof Promise?o.then(function(n){return n!==i.i18nVersion?t(null,null):t(null,i)}):o!==i.i18nVersion?t(null,null):(delete i.i18nVersion,delete i.i18nStamp,t(null,i))}},{key:"set",value:function(n,e,t){u.setItem(i(n,e,this.options),JSON.stringify(t))}},{key:"save",value:function(n,e,i){t()&&(i.i18nStamp=(new Date).getTime(),this.options.versions[n]&&(i.i18nVersion=this.options.versions[n]),this.set(n,e,i))}}]),o}();return l.type="backend",l});
